<html>
<head>
<title>Quinn Halpin, qmh4</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<style>
	svg { border: solid #ccc 1px; }
	body { font-family: 'Alegreya Sans', Calibri, sans-serif; }
	.words {width : 700px;}
</style>
</head>
<body>
<div>
	<p id = "ball_animation"></p>
	<div id = "user_input"></div>
</div>
<script type = "text/javascript" src = "animation.js"></script>
<script type="text/javascript">
 	var la_2011_data = [];
 	var la_2012_data = [];
 	var la_2013_data = [];
 	var la_2014_data = [];
 	var la_2015_data = [];
	var student_math = [];
	var student_por = [];
	var tree_arr = [];

	function parseRow(row) {
		// filter out name of person and entries that have no base pay
		if (Math.round(Number(row.base_pay)) != 0.){
			employee_object = row;
			delete employee_object["employee_name"];
			delete employee_object["notes"];
			employee_object["job_category"] = findCluster(row.job_title);
			return employee_object;
		}
	}

	function parseStudentRow(row) {
		// change all string numbers to numbers
		// yes = 1
		// no = 0
		row.Dalc = Number(row.Dalc);
		row.Fedu = Number(row.Fedu);
		row.G1 = Number(row.G1);
		row.G2 = Number(row.G2);
		row.G3 = Number(row.G3);
		row.Medu = Number(row.Medu);
		row.Walc = Number(row.Walc);
		row.absences = Number(row.absences);
		row.activities = (row.activities == "yes") ? 1: 0;

		row.age = Number(row.age);
		row.failures = Number(row.failures);
		row.famrel = Number(row.famrel);
		row.famsup = (row.famsup == "yes") ? 1 : 0;
		row.higher = (row.higher == "yes") ? 1: 0;
		row.internet = (row.internet == "yes") ? 1: 0;
		row.nursery = (row.nursery == "yes") ? 1: 0;
		row.romantic = (row.romantic == "yes") ? 1: 0;
		row.schoolsup = (row.schoolsup == "yes") ? 1: 0;
		
		row.freetime = Number(row.freetime);
		row.goout = Number(row.goout);
		row.health = Number(row.health);
		row.studytime = Number(row.studytime);
		row.traveltime = Number(row.traveltime);
		return row;
	}

 	d3.queue()
        .defer(d3.csv, "student_grades/student-mat.csv", parseStudentRow)
        .defer(d3.csv, "student_grades/student-por.csv", parseStudentRow)
        .await(load_data);
    
    function createTreePath(svg, tree_arr){
    	var path_arr = [];
    	var pathGenerator = d3.line()
			.x(function(d){return (d.x)})
			.y(function(d){return (d.y)});	
    	for (var i = 0; i < tree_arr.length; i++){
    		var p = d3.path();
    		p.moveTo(tree_arr[i][0]["x1"],tree_arr[i][0]["y1"])
    		var path_data = [];
    		for (var j = 0; j<tree_arr[i].length-1; j++){
    			p.lineTo( tree_arr[i][j]["x2"], tree_arr[i][j]["y2"]);
    			p.lineTo( tree_arr[i][j+1]["x1"], tree_arr[i][j+1]["y1"]);
    		}
			p.lineTo(tree_arr[i][tree_arr[i].length-1]["x2"], tree_arr[i][tree_arr[i].length-1]["y2"]);
    		p = p.toString();
    		svg_path= svg.append("path").attr("d", p).style("stroke-width", 2)
    		.attr("id", "path_" + i)
            .style("stroke", "steelblue")
            .style("stroke-width", "5px")
            .style("fill", "none")
            .style("opacity", 0);

            path_arr.push(svg_path);
    	}
    	return path_arr;
    }	

 	function load_data(error, math, portugal){
 		student_math = math;
 		student_por = portugal;
 		var ball_svg_height = 600;
		var ball_svg_width = 600;
		
		var ball_svg = d3.select("#ball_animation").append("svg")
		.attr("height", ball_svg_height)
		.attr("width", ball_svg_width);

		function hasInternet(person){
			return person.internet;
		}
		function hasRomance(person){
			return person.romantic;
		}
		function isHigher(person){
			return person.higher;
		}
		function hasNursery(person){
			return person.nursery;
		}
		function hasActivites(person){
			return person.activities;
		}
		var factor_arr = [hasActivites, hasInternet, hasRomance, isHigher, hasNursery]
		//(ball_svg,root_loc, height, width, full_data, factor_arr
		var splits = Math.pow(2,factor_arr.length)
		var curr_hue = 1;
 		d3.select("#user_input").append("input")
		.attr("type", "range")
		.attr("min", 0)
		.attr("max", 1)
		.attr("step",0.01)
		.on("input", function(){
			curr_speed = this.value
		});
		d3.select("#user_input").append("text").style("font", "17px times")
		.text("Speed");

		factor_obj = {"factor_arr": factor_arr, 
			"question_arr": [
				"Does the student do extracurriculars?", 
				"Does the student have internet?",
				"Is the student in a romantic relationship?",
				"Did the student go to higher education?",
				"Nursery????"
			]
		}

		var tree_root = {"x": 205, "y": 70};
		tree_arr = createTreeBegin(ball_svg, tree_root, 200, 200, splits);
		var paths = createTreePath(ball_svg, tree_arr);
 		spoutBalls(ball_svg, ball_svg_height, ball_svg_width, tree_arr, tree_root,student_math, factor_arr, paths);
 		
 		addStrings(ball_svg_height, ball_svg_width, tree_arr, ball_svg, factor_obj["question_arr"])
 	}	
</script>
</body>